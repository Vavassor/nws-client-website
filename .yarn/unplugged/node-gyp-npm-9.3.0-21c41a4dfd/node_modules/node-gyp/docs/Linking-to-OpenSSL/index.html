<p>A handful of native addons require linking to OpenSSL in one way or another. This introduces a small challenge since node will sometimes bundle OpenSSL statically (the default for node &gt;= v0.8.x), or sometimes dynamically link to the system OpenSSL (default for node &lt;= v0.6.x).</p>
<p>Good native addons should account for both scenarios. It's recommended that you use the <code>binding.gyp</code> file provided below as a starting-point for any addon that needs to use OpenSSL:</p>
<pre><code class="language-python">{
  'variables': {
    # node v0.6.x doesn't give us its build variables,
    # but on Unix it was only possible to use the system OpenSSL library,
    # so default the variable to &quot;true&quot;, v0.8.x node and up will overwrite it.
    'node_shared_openssl%': 'true'
  },
  'targets': [
    {
      'target_name': 'binding',
      'sources': [
        'src/binding.cc'
      ],
      'conditions': [
        ['node_shared_openssl==&quot;false&quot;', {
          # so when &quot;node_shared_openssl&quot; is &quot;false&quot;, then OpenSSL has been
          # bundled into the node executable. So we need to include the same
          # header files that were used when building node.
          'include_dirs': [
            '&lt;(node_root_dir)/deps/openssl/openssl/include'
          ],
          &quot;conditions&quot; : [
            [&quot;target_arch=='ia32'&quot;, {
              &quot;include_dirs&quot;: [ &quot;&lt;(node_root_dir)/deps/openssl/config/piii&quot; ]
            }],
            [&quot;target_arch=='x64'&quot;, {
              &quot;include_dirs&quot;: [ &quot;&lt;(node_root_dir)/deps/openssl/config/k8&quot; ]
            }],
            [&quot;target_arch=='arm'&quot;, {
              &quot;include_dirs&quot;: [ &quot;&lt;(node_root_dir)/deps/openssl/config/arm&quot; ]
            }]
          ]
        }]
      ]
    }
  ]
}
</code></pre>
<p>This ensures that when OpenSSL is statically linked into <code>node</code> then, the bundled OpenSSL headers are included, but when the system OpenSSL is in use, then only those headers will be used.</p>
<div class="heading-and-link">
<h2 id="windows%3F" tabindex="-1">Windows?</h2>
<a class="header-anchor" href="#windows%3F"><span class="visually-hidden">Permalink to “Windows?”</span> <span aria-hidden="true">#</span></a></div>
<p>As you can see this baseline <code>binding.gyp</code> file only accounts for the Unix scenario. Currently on Windows the situation is a little less ideal. On Windows, OpenSSL is <em>always</em> statically compiled into the <code>node</code> executable, so ideally it would be possible to use that copy of OpenSSL when building native addons.</p>
<p>Unfortunately it doesn't seem like that is possible at the moment, as there would need to be tweaks made to the generated <code>node.lib</code> file to include the openssl glue functions, or a new <code>openssl.lib</code> file would need to be created during the node build. I'm not sure which is the easiest/most feasible.</p>
<p>In the meantime, one possible solution is using another copy of OpenSSL, which is what <a href="https://github.com/ncb000gt/node.bcrypt.js"><code>node-bcrypt</code></a> currently does. Adding something like this to your <code>binding.gyp</code> file's <code>&quot;conditions&quot;</code> block would enable this:</p>
<pre><code class="language-python">    [ 'OS==&quot;win&quot;', {
      'conditions': [
        # &quot;openssl_root&quot; is the directory on Windows of the OpenSSL files.
        # Check the &quot;target_arch&quot; variable to set good default values for
        # both 64-bit and 32-bit builds of the module.
        ['target_arch==&quot;x64&quot;', {
          'variables': {
            'openssl_root%': 'C:/OpenSSL-Win64'
          },
        }, {
          'variables': {
            'openssl_root%': 'C:/OpenSSL-Win32'
          },
        }],
      ],
      'libraries': [ 
        '-l&lt;(openssl_root)/lib/libeay32.lib',
      ],
      'include_dirs': [
        '&lt;(openssl_root)/include',
      ],
    }]
</code></pre>
<p>Now you can direct your users to install OpenSSL on Windows from here (be sure to tell them to install the 64-bit version if they're compiling against a 64-bit version of node): <a href="http://slproweb.com/products/Win32OpenSSL.html">http://slproweb.com/products/Win32OpenSSL.html</a></p>
<p>Also note that both <code>node-gyp</code> and <code>npm</code> allow you to overwrite that default <code>openssl_root</code> variable on the command line:</p>
<pre><code class="language-bash">$ node-gyp rebuild --openssl-root=&quot;C:\Users\Nathan\Desktop\openssl&quot;
</code></pre>
