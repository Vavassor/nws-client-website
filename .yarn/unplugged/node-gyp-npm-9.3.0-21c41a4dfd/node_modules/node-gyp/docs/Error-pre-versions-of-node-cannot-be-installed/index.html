<p>When using <code>node-gyp</code> you might see an error like this when attempting to compile/install a node.js native addon:</p>
<pre><code>$ npm install bcrypt
npm http GET https://registry.npmjs.org/bcrypt/0.7.5
npm http 304 https://registry.npmjs.org/bcrypt/0.7.5
npm http GET https://registry.npmjs.org/bindings/1.0.0
npm http 304 https://registry.npmjs.org/bindings/1.0.0

&gt; bcrypt@0.7.5 install /home/ubuntu/public/song-swap/node_modules/bcrypt
&gt; node-gyp rebuild

gyp ERR! configure error
gyp ERR! stack Error: &quot;pre&quot; versions of node cannot be installed, use the --nodedir flag instead
gyp ERR! stack     at install (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/install.js:69:16)
gyp ERR! stack     at Object.self.commands.(anonymous function) [as install] (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/node-gyp.js:56:37)
gyp ERR! stack     at getNodeDir (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:219:20)
gyp ERR! stack     at /usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:105:9
gyp ERR! stack     at ChildProcess.exithandler (child_process.js:630:7)
gyp ERR! stack     at ChildProcess.EventEmitter.emit (events.js:99:17)
gyp ERR! stack     at maybeClose (child_process.js:730:16)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:797:5)
gyp ERR! System Linux 3.5.0-21-generic
gyp ERR! command &quot;node&quot; &quot;/usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd /home/ubuntu/public/song-swap/node_modules/bcrypt
gyp ERR! node -v v0.11.2-pre
gyp ERR! node-gyp -v v0.9.5
gyp ERR! not ok
npm ERR! bcrypt@0.7.5 install: `node-gyp rebuild`
npm ERR! `sh &quot;-c&quot; &quot;node-gyp rebuild&quot;` failed with 1
npm ERR!
npm ERR! Failed at the bcrypt@0.7.5 install script.
npm ERR! This is most likely a problem with the bcrypt package,
npm ERR! not with npm itself.
npm ERR! Tell the author that this fails on your system:
npm ERR!     node-gyp rebuild
npm ERR! You can get their info via:
npm ERR!     npm owner ls bcrypt
npm ERR! There is likely additional logging output above.

npm ERR! System Linux 3.5.0-21-generic
npm ERR! command &quot;/usr/local/bin/node&quot; &quot;/usr/local/bin/npm&quot; &quot;install&quot; &quot;bcrypt&quot;
npm ERR! cwd /home/ubuntu/public/song-swap
npm ERR! node -v v0.11.2-pre
npm ERR! npm -v 1.2.18
npm ERR! code ELIFECYCLE
npm ERR!
npm ERR! Additional logging details can be found in:
npm ERR!     /home/ubuntu/public/song-swap/npm-debug.log
npm ERR! not ok code 0
</code></pre>
<p>The main error here is:</p>
<pre><code>Error: &quot;pre&quot; versions of node cannot be installed, use the --nodedir flag instead
</code></pre>
<p>This error is caused when you attempt to compile a native addon using a version of node.js with <code>-pre</code> at the end of the version number:</p>
<pre><code class="language-bash">$ node -v
v0.10.4-pre
</code></pre>
<div class="heading-and-link">
<h2 id="how-to-avoid-(the-short-answer)" tabindex="-1">How to avoid (the short answer)</h2>
<a class="header-anchor" href="#how-to-avoid-(the-short-answer)"><span class="visually-hidden">Permalink to “How to avoid (the short answer)”</span> <span aria-hidden="true">#</span></a></div>
<p>To avoid this error completely just use a stable release of node.js. i.e. <code>v0.10.4</code>, and <strong>not</strong> <code>v0.10.4-pre</code>.</p>
<div class="heading-and-link">
<h2 id="how-to-fix-(the-long-answer)" tabindex="-1">How to fix (the long answer)</h2>
<a class="header-anchor" href="#how-to-fix-(the-long-answer)"><span class="visually-hidden">Permalink to “How to fix (the long answer)”</span> <span aria-hidden="true">#</span></a></div>
<p>This error happens because <code>node-gyp</code> does not know what header files were used to compile your &quot;pre&quot; version of node, and therefore it needs you to specify the node source code directory path using the <code>--nodedir</code> flag.</p>
<p>For example, if I compiled my development (&quot;pre&quot;) version of node.js using the source code in <code>/Users/nrajlich/node</code>, then I could invoke <code>node-gyp</code> like:</p>
<pre><code class="language-bash">$ node-gyp rebuild --nodedir=/Users/nrajlich/node
</code></pre>
<p>Or install an native addon through <code>npm</code> like:</p>
<pre><code class="language-bash">$ npm install bcrypt --nodedir=/Users/nrajlich/node
</code></pre>
<div class="heading-and-link">
<h3 id="always-use---nodedir" tabindex="-1">Always use <code>--nodedir</code></h3>
<a class="header-anchor" href="#always-use---nodedir"><span class="visually-hidden">Permalink to “Always use --nodedir”</span> <span aria-hidden="true">#</span></a></div>
<p><strong>Note:</strong> This is for advanced users who use <code>-pre</code> versions of node more often than tagged releases.</p>
<p>If you're invoking <code>node-gyp</code> through <code>npm</code>, then you can leverage <code>npm</code>'s configuration system and not have to specify the <code>--nodedir</code> flag all the time:</p>
<pre><code class="language-bash">$ npm config set nodedir /Users/nrajlich/node
</code></pre>
