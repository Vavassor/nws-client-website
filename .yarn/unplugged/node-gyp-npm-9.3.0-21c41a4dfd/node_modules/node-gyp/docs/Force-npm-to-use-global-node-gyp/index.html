<div class="heading-and-link">
<h1 id="force-npm-to-use-global-installed-node-gyp" tabindex="-1">Force npm to use global installed node-gyp</h1>
<a class="header-anchor" href="#force-npm-to-use-global-installed-node-gyp"><span class="visually-hidden">Permalink to “Force npm to use global installed node-gyp”</span> <span aria-hidden="true">#</span></a></div>
<p><strong>Note: These instructions only work with npm 6 or older. For a solution that works with npm 8 (or older), see <a href="Updating-npm-bundled-node-gyp.md">Updating-npm-bundled-node-gyp.md</a>.</strong></p>
<p><a href="https://github.com/nodejs/node-gyp/labels/ERR%21%20node-gyp%20-v%20%3C%3D%20v5.1.0">Many issues</a> are opened by users who are<br>
not running a <a href="https://github.com/nodejs/node-gyp/releases">current version of node-gyp</a>.</p>
<p>npm bundles its own, internal, copy of node-gyp located at <code>npm/node_modules</code>, within npm's private dependencies which are separate from <em>globally</em> accessible packages. Therefore this internal copy of node-gyp is independent from any globally installed copy of node-gyp that<br>
may have been installed via <code>npm install -g node-gyp</code>.</p>
<p>So npm's internal copy of node-gyp <strong>isn't</strong> stored inside <em>global</em> <code>node_modules</code> and thus isn't available for use as a standalone package. npm uses it's <em>internal</em> copy of <code>node-gyp</code> to automatically build native addons.</p>
<p>When you install a <em>new</em> version of node-gyp outside of npm, it'll go into your <em>global</em> <code>node_modules</code>, but not under the <code>npm/node_modules</code> (where internal copy of node-gyp is stored). So it will get into your <code>$PATH</code> and you will be able to use this globally installed version (<strong>but not internal node-gyp of npm</strong>) as any other globally installed package.</p>
<p>The catch is that npm <strong>won't</strong> use global version unless you tell it to, it'll keep on using the <strong>internal one</strong>. You need to instruct it to by setting the <code>node_gyp</code> config variable (which goes into your <code>~/.npmrc</code>). You do this by running the <code>npm config set</code> command as below. Then npm will use the command in the path you supply whenever it needs to build a native addon.</p>
<p><strong>Important</strong>: You also need to remember to unset this when you upgrade npm with a newer version of node-gyp, or you have to manually keep your globally installed node-gyp to date. See &quot;Undo&quot; below.</p>
<div class="heading-and-link">
<h2 id="linux-and-macos" tabindex="-1">Linux and macOS</h2>
<a class="header-anchor" href="#linux-and-macos"><span class="visually-hidden">Permalink to “Linux and macOS”</span> <span aria-hidden="true">#</span></a></div>
<pre><code>npm install --global node-gyp@latest
npm config set node_gyp $(npm prefix -g)/lib/node_modules/node-gyp/bin/node-gyp.js
</code></pre>
<p><code>sudo</code> may be required for the first command if you get a permission error.</p>
<div class="heading-and-link">
<h2 id="windows" tabindex="-1">Windows</h2>
<a class="header-anchor" href="#windows"><span class="visually-hidden">Permalink to “Windows”</span> <span aria-hidden="true">#</span></a></div>
<div class="heading-and-link">
<h3 id="windows-command-prompt" tabindex="-1">Windows Command Prompt</h3>
<a class="header-anchor" href="#windows-command-prompt"><span class="visually-hidden">Permalink to “Windows Command Prompt”</span> <span aria-hidden="true">#</span></a></div>
<pre><code>npm install --global node-gyp@latest
for /f &quot;delims=&quot; %P in ('npm prefix -g') do npm config set node_gyp &quot;%P\node_modules\node-gyp\bin\node-gyp.js&quot;
</code></pre>
<div class="heading-and-link">
<h3 id="powershell" tabindex="-1">Powershell</h3>
<a class="header-anchor" href="#powershell"><span class="visually-hidden">Permalink to “Powershell”</span> <span aria-hidden="true">#</span></a></div>
<pre><code>npm install --global node-gyp@latest
npm prefix -g | % {npm config set node_gyp &quot;$_\node_modules\node-gyp\bin\node-gyp.js&quot;}
</code></pre>
<div class="heading-and-link">
<h2 id="undo" tabindex="-1">Undo</h2>
<a class="header-anchor" href="#undo"><span class="visually-hidden">Permalink to “Undo”</span> <span aria-hidden="true">#</span></a></div>
<p><strong>Beware</strong> if you don't unset the <code>node_gyp</code> config option, npm will continue to use the globally installed version of node-gyp rather than the one it ships with, which may end up being newer.</p>
<pre><code>npm config delete node_gyp
npm uninstall --global node-gyp
</code></pre>
