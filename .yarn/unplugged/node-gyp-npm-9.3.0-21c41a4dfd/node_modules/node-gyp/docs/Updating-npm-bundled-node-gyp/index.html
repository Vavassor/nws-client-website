<div class="heading-and-link">
<h1 id="updating-the-npm-bundled-version-of-node-gyp" tabindex="-1">Updating the npm-bundled version of node-gyp</h1>
<a class="header-anchor" href="#updating-the-npm-bundled-version-of-node-gyp"><span class="visually-hidden">Permalink to “Updating the npm-bundled version of node-gyp”</span> <span aria-hidden="true">#</span></a></div>
<p><strong>Note: These instructions are (only) tested and known to work with npm 8 and older.</strong></p>
<p><strong>Note: These instructions will be undone if you reinstall or upgrade npm or node! For a more permanent (and simpler) solution, see <a href="Force-npm-to-use-global-node-gyp.md">Force-npm-to-use-global-node-gyp.md</a>. (npm 6 or older only!)</strong></p>
<p><a href="https://github.com/nodejs/node-gyp/issues?q=label%3A%22ERR!+node-gyp+-v+%3C%3D+v9.x.x%22">Many issues</a> are opened by users who are<br>
not running a <a href="https://github.com/nodejs/node-gyp/releases">current version of node-gyp</a>.</p>
<p><code>npm</code> bundles its own, internal, copy of <code>node-gyp</code>. This internal copy is independent of any globally installed copy of node-gyp that<br>
may have been installed via <code>npm install -g node-gyp</code>.</p>
<p>This means that while <code>node-gyp</code> doesn't get installed into your <code>$PATH</code> by default, npm still keeps its own copy to invoke when you<br>
attempt to <code>npm install</code> a native add-on.</p>
<p>Sometimes, you may need to update npm's internal node-gyp to a newer version than what is installed. A simple <code>npm install -g node-gyp</code><br>
<em>won't</em> do the trick since npm will still continue to use its internal copy over the global one.</p>
<p>So instead:</p>
<div class="heading-and-link">
<h2 id="version-of-npm" tabindex="-1">Version of npm</h2>
<a class="header-anchor" href="#version-of-npm"><span class="visually-hidden">Permalink to “Version of npm”</span> <span aria-hidden="true">#</span></a></div>
<p>We need to start by knowing your version of <code>npm</code>:</p>
<pre><code class="language-bash">npm --version
</code></pre>
<div class="heading-and-link">
<h2 id="linux%2C-macos%2C-solaris%2C-etc." tabindex="-1">Linux, macOS, Solaris, etc.</h2>
<a class="header-anchor" href="#linux%2C-macos%2C-solaris%2C-etc."><span class="visually-hidden">Permalink to “Linux, macOS, Solaris, etc.”</span> <span aria-hidden="true">#</span></a></div>
<p>Unix is easy. Just run the following command.</p>
<p>If your npm is version <em><strong>7 or 8</strong></em>, do:</p>
<pre><code class="language-bash">$ npm explore npm/node_modules/@npmcli/run-script -g -- npm_config_global=false npm install node-gyp@latest
</code></pre>
<p>Else if your npm is version <em><strong>less than 7</strong></em>, do:</p>
<pre><code class="language-bash">$ npm explore npm/node_modules/npm-lifecycle -g -- npm install node-gyp@latest
</code></pre>
<p>If the command fails with a permissions error, please try <code>sudo</code> and then the command.</p>
<div class="heading-and-link">
<h2 id="windows" tabindex="-1">Windows</h2>
<a class="header-anchor" href="#windows"><span class="visually-hidden">Permalink to “Windows”</span> <span aria-hidden="true">#</span></a></div>
<p>Windows is a bit trickier, since <code>npm</code> might be installed to the &quot;Program Files&quot; directory, which needs admin privileges in order to<br>
modify on current Windows. Therefore, run the following commands <strong>inside a <code>cmd.exe</code> started with &quot;Run as Administrator&quot;</strong>:</p>
<p>First we need to find the location of <code>node</code>. If you don't already know the location that <code>node.exe</code> got installed to, then run:</p>
<pre><code class="language-bash">$ where node
</code></pre>
<p>Now <code>cd</code> to the directory that <code>node.exe</code> is contained in e.g.:</p>
<pre><code class="language-bash">$ cd &quot;C:\Program Files\nodejs&quot;
</code></pre>
<p>If your npm version is <em><strong>7 or 8</strong></em>, do:</p>
<pre><code class="language-bash">cd node_modules\npm\node_modules\@npmcli\run-script
</code></pre>
<p>Else if your npm version is <em><strong>less than 7</strong></em>, do:</p>
<pre><code class="language-bash">cd node_modules\npm\node_modules\npm-lifecycle
</code></pre>
<p>Finish by running:</p>
<pre><code class="language-bash">$ npm install node-gyp@latest
</code></pre>
